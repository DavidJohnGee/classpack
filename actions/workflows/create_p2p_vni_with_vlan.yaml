version: '2.0'
classpack.create_p2p_vni_with_vlan:
    description: Configure vlan,enable the switch port mode and configure the port speed on switch
    type: direct
    input:
        - mgmt_ip
        - username
        - password
        - intf_desc
        - intf_type
        - intf_name
        - enabled
        - vlan_and_vni_id
        - switchport_mode
        - vlan_and_vni_desc
    tasks:
        create_vni:
            action: dcfabric.create_l2_tenant_evpn
            input:
                mgmt_ip: <% $.mgmt_ip %>
                username: <% $.username %>
                password: <% $.password %>
                vni: <% $.vlan_and_vni_id %>
            on-success:
                - set_intf_admin_state
        set_intf_admin_state:
            action: network_essentials.set_intf_admin_state
            input:
                mgmt_ip: <% $.mgmt_ip %>
                username: <% $.username %>
                password: <% $.password %>
                intf_type: <% $.intf_type %>
                intf_name: <% $.intf_name %>
                enabled: <% $.enabled %>
                intf_desc: <% $.intf_desc %>
            on-success:
                - create_vlan
        create_vlan:
            action: network_essentials.create_vlan
            input:
                mgmt_ip: <% $.mgmt_ip %>
                username: <% $.username %>
                password: <% $.password %>
                vlan_desc: <% $.vlan_and_vni_desc %>
                vlan_id: <% $.vlan_and_vni_id %>
            on-success:
                - create_switchport_access : <% $.switchport_mode = 'access' %>
                - create_switchport_trunk  : <% $.switchport_mode = 'trunk' %>
        create_switchport_access:
            action: network_essentials.create_switchport_access
            input:
                mgmt_ip: <% $.mgmt_ip %>
                username: <% $.username %>
                password: <% $.password %>
                intf_type: <% $.intf_type %>
                intf_name: <% $.intf_name %>
                vlan_id: <% $.vlan_and_vni_id %>
        create_switchport_trunk:
            action: network_essentials.create_switchport_trunk
            input:
                mgmt_ip: <% $.mgmt_ip %>
                username: <% $.username %>
                password: <% $.password %>
                intf_type: <% $.intf_type %>
                intf_name: <% $.intf_name %>
                vlan_id: <% $.vlan_and_vni_id %>
